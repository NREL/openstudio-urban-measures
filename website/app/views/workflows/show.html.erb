<h2>Workflow</h2>

<h3 class="edit-name"><%= @workflow.id %> <% if can? :update, Workflow %><%= link_to "[ edit ]", edit_workflow_path(@workflow), class: "edit-link" %><% end %></h3>

<table class="table table-striped">
  <tr>
    <th>ID</th>
    <td><%= @workflow.id.to_s %></td>
  </tr>
  <tr>
    <th>Display Name</th>
    <td><%= @workflow.display_name.to_s %></td>
  </tr>
  <tr>
    <th>Name</th>
    <td><%= @workflow.name.to_s %></td>
  </tr>
  <tr>
    <th>Project</th>
    <td><%= link_to @workflow.project.display_name, @workflow.project %></td>
  </tr>
  <% @workflow.attributes.keys.sort.each do |key| %>
    <% unless key == '_id' || key == 'project_id' || key == 'name' || key == 'display_name' %>
      <tr>
      	<% if key == 'workflow_file' %>
      		<th>Related Zip File</th>
      		<td> <%= link_to @workflow.workflow_file.file_name, download_zipfile_workflow_path(@workflow) %><br/></td>
  	    <% else %>
  	      <th> <%= key.humanize%></th>
        	<td><%= @workflow[key] %></td>
        <% end %>
      </tr>
    <% end %>
   <% end %>
</table>


<h3>Datapoints</h3>

<div class="pad-top-20 pad-bot-20">
  <%= link_to 'Create Datapoints for All Buildings', create_datapoints_workflow_path(id: @workflow), class: "btn btn-primary" %> <%= link_to 'Delete Datapoints for this workflow', delete_datapoints_workflow_path(id: @workflow), class: "btn btn-primary" %> 
</div>

<h3>Datapoints (<%= @workflow.datapoints.count %>)</h3>
<% if @workflow.datapoints.count <= 0 %>
  <p>There are no datapoints associated with this workflow.</p>
<% else %>
  <%= link_to 'Show GeoJSON Results', datapoints_workflow_path(id: @workflow, format: :html), class: "btn btn-primary" %>
  <table class="tablesorter table table-striped">
    <thead>
    <tr>
      <th>ID</th>
      <th>Building</th>
      <th>Status</th>  
      <% if can? :update, Datapoint %><th>Actions</th><% end %>

    </tr>
    </thead>
    <tbody>
    <% @workflow.datapoints.each do |datapoint| %>
      <tr>
        <td><%= link_to datapoint.id, datapoint %></td>
        <td><%= link_to datapoint.building.id, datapoint.building if datapoint.building %></td>
        <td><%= datapoint.status %></td>
        <% if can? :update, Datapoint %><td><%= link_to 'Edit', edit_datapoint_path(datapoint) %> | <%= link_to 'Destroy', datapoint, method: :delete, data: { confirm: 'Are you sure?' } %></td><% end %>
      </tr>
    <% end %>
    </tbody>
  </table>
<% end %>